<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspection Pr√©ventive - Lou-Tec</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Styles pour le formulaire */
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f4f8;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
        }

        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo img {
            max-width: 200px;
            height: auto;
        }

        h2 {
            color: #004a99;
            text-align: center;
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin: 15px 0 5px;
            color: #004a99;
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 16px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        th {
            background: #004a99;
            color: white;
        }

        .photo-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #004a99;
            border-radius: 5px;
        }

        .photo-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .photo-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid #004a99;
        }

        button {
            background: #004a99;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        button:hover {
            background: #003366;
        }

        .range-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #etatValue {
            font-weight: bold;
            color: #004a99;
        }

        .error {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <img src="logo.png" alt="Lou-Tec">
        </div>
        <h2>Formulaire d'Inspection Pr√©ventive</h2>

        <form id="inspectionForm">
            <!-- Section Informations -->
            <div class="form-section">
                <label>Num√©ro d'√©quipement:</label>
                <input type="text" name="numero_equipement" required>

                <label>Mod√®le:</label>
                <input type="text" name="modele" required>

                <label>Emplacement:</label>
                <input type="text" name="emplacement" required>

                <label>√âtat g√©n√©ral (0 √† 10):</label>
                <div class="range-container">
                    <input type="range" name="etat_general" min="0" max="10" value="5" 
                           oninput="document.getElementById('etatValue').textContent = this.value">
                    <span id="etatValue">5</span>/10
                </div>

                <label>Date de l'inspection:</label>
                <input type="date" name="date" required>
            </div>

            <!-- Tableau de Conformit√© -->
            <table>
                <tr>
                    <th>Crit√®res</th>
                    <th>Conforme</th>
                    <th>Non Conforme</th>
                </tr>
                <tr>
                    <td>Fonctionnement</td>
                    <td><input type="radio" name="fonctionnement" value="conforme"></td>
                    <td><input type="radio" name="fonctionnement" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Pr√©sence de Fuite</td>
                    <td><input type="radio" name="fuite" value="conforme"></td>
                    <td><input type="radio" name="fuite" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Garde Corps</td>
                    <td><input type="radio" name="garde_corps" value="conforme"></td>
                    <td><input type="radio" name="garde_corps" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Pneu</td>
                    <td><input type="radio" name="pneu" value="conforme"></td>
                    <td><input type="radio" name="pneu" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Contenu Porte Document</td>
                    <td><input type="radio" name="document" value="conforme"></td>
                    <td><input type="radio" name="document" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Inspection √† jour</td>
                    <td><input type="radio" name="inspection" value="conforme"></td>
                    <td><input type="radio" name="inspection" value="non_conforme"></td>
                </tr>
                <tr>
                    <td>Maintenance √† jour</td>
                    <td><input type="radio" name="maintenance" value="conforme"></td>
                    <td><input type="radio" name="maintenance" value="non_conforme"></td>
                </tr>
            </table>

            <!-- Section Photos -->
            <div class="photo-section">
                <label>Photos (maximum 5):</label>
                <div class="photo-preview" id="photoPreview"></div>
                <div style="display: flex; gap: 10px;">
                    <label style="cursor: pointer;">
                        <input type="file" id="fileInput" accept="image/*" multiple 
                               style="display: none;" onchange="handleFileSelect(event)">
                        üì§ Importer des photos
                    </label>
                </div>
            </div>

            <!-- Observations -->
            <label>Observations:</label>
            <textarea name="explication" rows="4"></textarea>

            <!-- Boutons -->
            <button type="button" onclick="validateForm()">üìÑ G√©n√©rer le rapport PDF</button>
        </form>
    </div>

    <script>
        'use strict';

        let photos = [];
        const MAX_PHOTOS = 5;

        // Fonction pour valider les donn√©es du formulaire
        function validateForm() {
            let isValid = true;
            const form = document.getElementById('inspectionForm');

            // Validation des champs texte
            const requiredFields = ['numero_equipement', 'modele', 'emplacement', 'date'];
            requiredFields.forEach(field => {
                const input = form.querySelector(`[name="${field}"]`);
                if (!input.value.trim()) {
                    isValid = false;
                    alert(`Le champ ${field} est requis.`);
                }
            });

            // Validation des radio buttons
            const radioGroups = ['fonctionnement', 'fuite', 'garde_corps', 'pneu', 'document', 'inspection', 'maintenance'];
            radioGroups.forEach(group => {
                const radios = form.querySelectorAll(`[name="${group}"]`);
                if (![...radios].some(radio => radio.checked)) {
                    isValid = false;
                    alert(`Veuillez s√©lectionner une option pour: ${group}`);
                }
            });

            if (isValid) genererPDF();
        }

        // Fonction pour g√©n√©rer le PDF
        function genererPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Ajout du logo si disponible
            const logo = document.querySelector('.logo img');
            if (logo) {
                doc.addImage(logo, 'PNG', 15, 15, 40, 20);
            }

            doc.setFontSize(18);
            doc.setTextColor(0, 74, 153);
            doc.text("Rapport d'Inspection Pr√©ventive", 15, 45);

            // Informations
            const formData = {
                numero: document.querySelector('[name="numero_equipement"]').value,
                modele: document.querySelector('[name="modele"]').value,
                emplacement: document.querySelector('[name="emplacement"]').value,
                etat: document.querySelector('[name="etat_general"]').value + "/10",
                date: document.querySelector('[name="date"]').value
            };

            doc.setFontSize(12);
            doc.text(`Num√©ro d'√©quipement: ${formData.numero}`, 15, 60);
            doc.text(`Mod√®le: ${formData.modele}`, 15, 70);
            doc.text(`Emplacement: ${formData.emplacement}`, 15, 80);
            doc.text(`√âtat g√©n√©ral: ${formData.etat}`, 15, 90);
            doc.text(`Date de l'inspection: ${formData.date}`, 15, 100);

            // Tableau de conformit√©
            const rows = Array.from(document.querySelectorAll('table tr:not(:first-child)')).map(tr => {
                const tds = tr.querySelectorAll('td');
                return [
                    tds[0].innerText,
                    tds[1].querySelector('input:checked') ? 'X' : '',
                    tds[2].querySelector('input:checked') ? '' : 'X'
                ];
            });

            doc.autoTable({
                startY: 110,
                head: [['Crit√®res', 'Conforme', 'Non Conforme']],
                body: rows,
                theme: 'grid',
                styles: { fontSize: 10 },
                headStyles: { 
                    fillColor: [0, 74, 153],
                    textColor: 255
                },
                columnStyles: {
                    0: { cellWidth: 100 },
                    1: { cellWidth: 30 },
                    2: { cellWidth: 30 }
                }
            });

            // Observations
            doc.setFontSize(12);
            doc.setTextColor(0, 74, 153);
            doc.text("Observations:", 15, doc.lastAutoTable.finalY + 10);
            const observations = document.querySelector('[name="explication"]').value || 'Aucune observation';
            doc.setFontSize(10);
            doc.setTextColor(0);
            doc.text(observations, 15, doc.lastAutoTable.finalY + 20);

            // Photos (si disponibles)
            if (photos.length > 0) {
                doc.setFontSize(12);
                doc.setTextColor(0, 74, 153);
                doc.text("Photos de l'inspection:", 15, doc.lastAutoTable.finalY + 30);
                const photoWidth = 50;
                const photoHeight = 50;
                photos.forEach((photo, index) => {
                    doc.addImage(photo, 'PNG', 15 + index * (photoWidth + 10), doc.lastAutoTable.finalY + 40, photoWidth, photoHeight);
                });
            }

            // Sauvegarder le PDF
            doc.save(`Inspection_Preventive_${formData.numero}.pdf`);
        }

        // Fonction pour g√©rer la s√©lection des fichiers photo
        function handleFileSelect(event) {
            const files = event.target.files;
            if (files.length + photos.length > MAX_PHOTOS) {
                alert(`Vous pouvez ajouter un maximum de ${MAX_PHOTOS} photos.`);
                return;
            }
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photos.push(e.target.result);
                        updatePhotoPreview();
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Seules les images sont autoris√©es.');
                }
            });
        }

        // Fonction pour mettre √† jour l'aper√ßu des photos
        function updatePhotoPreview() {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';
            photos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                preview.appendChild(img);
            });
        }
    </script>
</body>
</html>
